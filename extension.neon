parameters:
  dynamicConstantNames:
    - APP_NAMESPACE
    - CI_DEBUG
    - ENVIRONMENT
  universalObjectCratesClasses:
    - CodeIgniter\Entity\Entity
  codeigniter:
    additionalConfigNamespaces: []
    additionalModelNamespaces: []
    additionalServices: []
    checkArgumentTypeOfFactories: true
    checkArgumentTypeOfServices: true

parametersSchema:
  codeigniter: structure([
    additionalConfigNamespaces: listOf(string())
    additionalModelNamespaces: listOf(string())
    additionalServices: listOf(string())
    checkArgumentTypeOfFactories: bool()
    checkArgumentTypeOfServices: bool()
  ])

services:
  factoriesReturnTypeHelper:
    class: CodeIgniter\PHPStan\Type\FactoriesReturnTypeHelper
    arguments:
      additionalConfigNamespaces: %codeigniter.additionalConfigNamespaces%
      additionalModelNamespaces: %codeigniter.additionalModelNamespaces%

  servicesReturnTypeHelper:
    class: CodeIgniter\PHPStan\Type\ServicesReturnTypeHelper
    arguments:
      additionalServices: %codeigniter.additionalServices%

  superglobalRuleHelper:
    class: CodeIgniter\PHPStan\Rules\Superglobals\SuperglobalRuleHelper

  -
    class: CodeIgniter\PHPStan\Type\FactoriesFunctionReturnTypeExtension
    tags:
      - phpstan.broker.dynamicFunctionReturnTypeExtension

  -
    class: CodeIgniter\PHPStan\Type\ServicesFunctionReturnTypeExtension
    tags:
      - phpstan.broker.dynamicFunctionReturnTypeExtension

  -
    class: CodeIgniter\PHPStan\Rules\Functions\FactoriesFunctionArgumentTypeRule

  -
    class: CodeIgniter\PHPStan\Rules\Functions\ServicesFunctionArgumentTypeRule

conditionalTags:
  CodeIgniter\PHPStan\Rules\Functions\FactoriesFunctionArgumentTypeRule:
    phpstan.rules.rule: %codeigniter.checkArgumentTypeOfFactories%
  CodeIgniter\PHPStan\Rules\Functions\ServicesFunctionArgumentTypeRule:
    phpstan.rules.rule: %codeigniter.checkArgumentTypeOfServices%

rules:
  - CodeIgniter\PHPStan\Rules\Classes\CacheHandlerInstantiationRule
  - CodeIgniter\PHPStan\Rules\Classes\FrameworkExceptionInstantiationRule
  - CodeIgniter\PHPStan\Rules\Superglobals\SuperglobalAccessRule
  - CodeIgniter\PHPStan\Rules\Superglobals\SuperglobalAssignRule
